{
  "__inputs": [
    {
      "name": "DS_PROMETHEUS",
      "label": "Prometheus",
      "description": "http://prometheus:9090",
      "type": "datasource",
      "pluginId": "prometheus",
      "pluginName": "Prometheus"
    }
  ],
  "__requires": [
    { "type": "grafana", "id": "grafana", "name": "Grafana", "version": "5.4.3" },
    { "type": "panel", "id": "graph", "name": "Graph", "version": "5.0.0" },
    { "type": "datasource", "id": "prometheus", "name": "Prometheus", "version": "5.0.0" },
    { "type": "panel", "id": "singlestat", "name": "Singlestat", "version": "5.0.0" },
    { "type": "panel", "id": "table", "name": "Table", "version": "5.0.0" }
  ],
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "description": "Docker host and container metrics (cAdvisor/Prometheus).",
  "editable": true,
  "gnetId": 10619,
  "graphTooltip": 1,
  "id": null,
  "iteration": 1700000000000,
  "links": [],
  "panels": [
    {
      "cacheTimeout": null,
      "colorBackground": false,
      "colorValue": false,
      "colors": ["#299c46","rgba(237,129,40,0.89)","#d44a3a"],
      "datasource": "${DS_PROMETHEUS}",
      "format": "none",
      "gauge": { "maxValue": 100, "minValue": 0, "show": false, "thresholdLabels": false, "thresholdMarkers": true },
      "gridPos": { "h": 6, "w": 4, "x": 0, "y": 0 },
      "id": 22,
      "maxDataPoints": 100,
      "nullPointMode": "connected",
      "rangeMaps": [{ "from": "null", "text": "N/A", "to": "null" }],
      "sparkline": { "show": false },
      "targets": [
        {
          "expr": "count(max_over_time(container_last_seen{job=~\"$job\",instance=~\"${node:regex}(:${port:regex})?\",image!=\"\"}[5m]))",
          "format": "time_series",
          "refId": "A"
        }
      ],
      "thresholds": "",
      "title": "Running containers",
      "transparent": true,
      "type": "singlestat",
      "valueFontSize": "80%",
      "valueMaps": [{ "op": "=", "text": "N/A", "value": "null" }],
      "valueName": "avg"
    },
    {
      "aliasColors": { "{id=\"/\",instance=\"cadvisor:8080\",job=\"prometheus\"}": "#BA43A9" },
      "bars": false,
      "datasource": "${DS_PROMETHEUS}",
      "fill": 3,
      "gridPos": { "h": 6, "w": 8, "x": 4, "y": 0 },
      "id": 5,
      "legend": { "show": false },
      "lines": true,
      "linewidth": 2,
      "nullPointMode": "null as zero",
      "stack": true,
      "targets": [
        { "expr": "sum(rate(container_cpu_system_seconds_total[1m]))", "hide": true, "refId": "B" },
        { "expr": "sum(rate(container_cpu_system_seconds_total{name=~\".+\"}[1m]))", "hide": true, "refId": "F" },
        { "expr": "sum(rate(container_cpu_system_seconds_total{id=\"/\"}[1m]))", "hide": true, "refId": "A" },
        { "expr": "sum(rate(process_cpu_seconds_total[$interval])) * 100", "legendFormat": "host", "refId": "C" }
      ],
      "title": "CPU Usage on Node",
      "tooltip": { "msResolution": true, "shared": true, "sort": 0, "value_type": "cumulative" },
      "type": "graph",
      "xaxis": { "mode": "time", "show": false },
      "yaxes": [{ "format": "percent", "max": 120, "show": true }, { "format": "short", "show": false }]
    },
    {
      "aliasColors": { "Free Disk Space": "#7EB26D", "Used Disk Space": "#BF1B00" },
      "bars": false,
      "datasource": "${DS_PROMETHEUS}",
      "fill": 4,
      "gridPos": { "h": 4, "w": 4, "x": 12, "y": 0 },
      "id": 13,
      "legend": { "alignAsTable": true, "show": true },
      "lines": true,
      "linewidth": 3,
      "nullPointMode": "null as zero",
      "stack": true,
      "targets": [
        { "expr": "node_filesystem_avail_bytes{fstype!=\"tmpfs\",mountpoint!~\"/run.*\"}", "legendFormat": "{{mountpoint}}", "refId": "A" },
        { "expr": "node_filesystem_size_bytes{fstype!=\"tmpfs\",mountpoint!~\"/run.*\"} - node_filesystem_avail_bytes{fstype!=\"tmpfs\",mountpoint!~\"/run.*\"}", "legendFormat": "Used Disk Space", "refId": "B" }
      ],
      "title": "Free and Used Disk Space on Node",
      "type": "graph",
      "xaxis": { "mode": "time", "show": false },
      "yaxes": [{ "format": "bytes", "min": 0, "show": true }, { "format": "short", "show": false }]
    },
    {
      "aliasColors": { "Available Memory": "#7EB26D", "Unavailable Memory": "#BF1B00" },
      "bars": false,
      "datasource": "${DS_PROMETHEUS}",
      "fill": 4,
      "gridPos": { "h": 4, "w": 4, "x": 16, "y": 0 },
      "id": 20,
      "legend": { "show": false },
      "lines": true,
      "linewidth": 3,
      "nullPointMode": "null as zero",
      "stack": true,
      "targets": [
        { "expr": "node_memory_MemAvailable_bytes", "legendFormat": "Available Memory", "refId": "H" },
        { "expr": "node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes", "legendFormat": "Unavailable Memory", "refId": "G" }
      ],
      "title": "Available Memory on Node",
      "type": "graph",
      "xaxis": { "mode": "time", "show": false },
      "yaxes": [{ "format": "bytes", "show": true }, { "format": "short", "show": false }]
    },
    {
      "bars": false,
      "datasource": "${DS_PROMETHEUS}",
      "fill": 1,
      "gridPos": { "h": 4, "w": 2, "x": 20, "y": 0 },
      "id": 3,
      "legend": { "show": false },
      "lines": true,
      "linewidth": 2,
      "nullPointMode": "null as zero",
      "targets": [
        { "expr": "sum(rate(node_disk_read_bytes_total[$interval])) by (device)", "legendFormat": "READ on /{{device}}", "refId": "A" },
        { "expr": "sum(rate(node_disk_written_bytes_total[$interval])) by (device)", "legendFormat": "WRITE on /{{device}}", "refId": "B" }
      ],
      "title": "Disk I/O on Node",
      "type": "graph",
      "xaxis": { "mode": "time", "show": false },
      "yaxes": [{ "format": "Bps", "show": true }, { "format": "short", "show": false }]
    },
    {
      "aliasColors": { "node_load15": "#CCA300" },
      "bars": false,
      "datasource": "${DS_PROMETHEUS}",
      "fill": 0,
      "gridPos": { "h": 8, "w": 10, "x": 12, "y": 4 },
      "id": 4,
      "legend": { "current": true, "show": true, "values": true },
      "lines": true,
      "linewidth": 2,
      "nullPointMode": "null as zero",
      "targets": [{ "expr": "{__name__=~\"^node_load.*\"}", "legendFormat": "{{__name__}}", "refId": "A" }],
      "title": "System Load on Node",
      "type": "graph",
      "xaxis": { "mode": "time", "show": true },
      "yaxes": [{ "format": "short", "show": true }, { "format": "short", "show": true }]
    },
    {
      "bars": false,
      "datasource": "${DS_PROMETHEUS}",
      "fill": 5,
      "gridPos": { "h": 4, "w": 12, "x": 0, "y": 6 },
      "id": 19,
      "legend": { "show": false },
      "lines": true,
      "linewidth": 1,
      "nullPointMode": "null as zero",
      "targets": [
        { "expr": "sum(rate(container_network_receive_bytes_total{id=\"/\"}[$interval])) by (id)", "legendFormat": "RECEIVED", "refId": "A" },
        { "expr": "- sum(rate(container_network_transmit_bytes_total{id=\"/\"}[$interval])) by (id)", "legendFormat": "SENT", "refId": "B" }
      ],
      "title": "Network Traffic on Node",
      "type": "graph",
      "xaxis": { "mode": "time", "show": false },
      "yaxes": [{ "format": "bytes", "show": true }, { "format": "short", "show": false }]
    },
    {
      "bars": false,
      "datasource": "${DS_PROMETHEUS}",
      "fill": 5,
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 10 },
      "id": 1,
      "legend": { "show": true },
      "lines": true,
      "linewidth": 1,
      "nullPointMode": "null as zero",
      "stack": true,
      "targets": [
        { "expr": "sum(rate(container_cpu_usage_seconds_total{name=~\".+\"}[$interval])) by (name) * 100", "legendFormat": "{{name}}", "refId": "F" }
      ],
      "title": "CPU Usage per Container (Stacked)",
      "type": "graph",
      "xaxis": { "mode": "time", "show": true },
      "yaxes": [{ "format": "percent", "show": true }, { "format": "short", "show": false }]
    },
    {
      "bars": false,
      "datasource": "${DS_PROMETHEUS}",
      "fill": 3,
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 12 },
      "id": 10,
      "legend": { "show": true },
      "lines": true,
      "linewidth": 2,
      "nullPointMode": "null as zero",
      "stack": true,
      "targets": [
        { "expr": "sum(container_memory_rss{name=~\".+\"}) by (name)", "legendFormat": "{{name}}", "refId": "A" }
      ],
      "title": "Memory Usage per Container (Stacked)",
      "type": "graph",
      "xaxis": { "mode": "time", "show": true },
      "yaxes": [{ "format": "bytes", "show": true }, { "format": "short", "show": true }]
    },
    {
      "bars": false,
      "datasource": "${DS_PROMETHEUS}",
      "fill": 1,
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 18 },
      "id": 9,
      "legend": { "show": true },
      "lines": true,
      "linewidth": 2,
      "nullPointMode": "null as zero",
      "targets": [
        { "expr": "sum(rate(container_network_transmit_bytes_total{name=~\".+\"}[$interval])) by (name)", "legendFormat": "{{name}}", "refId": "A" }
      ],
      "title": "Sent Network Traffic per Container",
      "type": "graph",
      "xaxis": { "mode": "time", "show": true },
      "yaxes": [{ "format": "Bps", "show": true }, { "format": "short", "show": false }]
    },
    {
      "bars": false,
      "datasource": "${DS_PROMETHEUS}",
      "fill": 3,
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 18 },
      "id": 11,
      "legend": { "show": true },
      "lines": true,
      "linewidth": 2,
      "nullPointMode": "null as zero",
      "stack": true,
      "targets": [
        { "expr": "sum(container_memory_cache{name=~\".+\"}) by (name)", "legendFormat": "{{name}}", "refId": "C" }
      ],
      "title": "Cached Memory per Container (Stacked)",
      "type": "graph",
      "xaxis": { "mode": "time", "show": true },
      "yaxes": [{ "format": "bytes", "show": true }, { "format": "short", "show": false }]
    },
    {
      "columns": [{ "text": "Avg", "value": "avg" }],
      "datasource": "${DS_PROMETHEUS}",
      "fontSize": "100%",
      "gridPos": { "h": 7, "w": 12, "x": 12, "y": 24 },
      "id": 18,
      "pageSize": 100,
      "scroll": true,
      "showHeader": true,
      "sort": { "col": 0, "desc": true },
      "styles": [
        { "dateFormat": "YYYY-MM-DD HH:mm:ss", "pattern": "Time", "type": "date" },
        { "decimals": 2, "pattern": "/.*/", "type": "number", "unit": "short" }
      ],
      "targets": [
        { "expr": "cadvisor_version_info", "legendFormat": "cAdvisor Version: {{cadvisorVersion}}", "refId": "A" },
        { "expr": "prometheus_build_info", "legendFormat": "Prometheus Version: {{version}}", "refId": "B" },
        { "expr": "node_exporter_build_info", "legendFormat": "Node-Exporter Version: {{version}}", "refId": "C" },
        { "expr": "cadvisor_version_info", "legendFormat": "Docker Version: {{dockerVersion}}", "refId": "D" },
        { "expr": "cadvisor_version_info", "legendFormat": "Host OS Version: {{osVersion}}", "refId": "E" },
        { "expr": "cadvisor_version_info", "legendFormat": "Host Kernel Version: {{kernelVersion}}", "refId": "F" }
      ],
      "transform": "timeseries_aggregations",
      "type": "table",
      "title": ""
    }
  ],
  "refresh": "10s",
  "schemaVersion": 16,
  "style": "dark",
  "tags": [],
  "templating": {
    "list": [
      {
        "auto": true,
        "auto_count": 50,
        "auto_min": "50s",
        "current": { "text": "auto", "value": "$__auto_interval_interval" },
        "hide": 0,
        "includeAll": false,
        "label": "Interval",
        "multi": false,
        "name": "interval",
        "options": [],
        "query": "30s,1m,2m,3m,5m,7m,10m,30m,1h,6h,12h,1d,7d,14d,30d",
        "refresh": 2,
        "skipUrlSync": false,
        "type": "interval"
      },
      {
        "allValue": null,
        "current": { "text": "cadvisor", "value": "cadvisor" },
        "datasource": "${DS_PROMETHEUS}",
        "definition": "label_values(container_cpu_user_seconds_total, job)",
        "hide": 0,
        "includeAll": false,
        "label": "Job",
        "multi": false,
        "name": "job",
        "options": [],
        "query": "label_values(container_cpu_user_seconds_total, job)",
        "refresh": 1,
        "regex": "",
        "sort": 1,
        "type": "query",
        "useTags": false
      },
      {
        "allValue": ".*",
        "current": {},
        "datasource": "${DS_PROMETHEUS}",
        "definition": "label_values(container_cpu_user_seconds_total{job=~\"$job\"}, instance)",
        "hide": 0,
        "includeAll": true,
        "label": "Host",
        "multi": true,
        "name": "node",
        "options": [],
        "query": "label_values(container_cpu_user_seconds_total{job=~\"$job\"}, instance)",
        "refresh": 1,
        "regex": "/([^:]+):.*/",
        "sort": 1,
        "type": "query",
        "useTags": false
      },
      {
        "allValue": ".*",
        "current": {},
        "datasource": "${DS_PROMETHEUS}",
        "definition": "label_values(container_cpu_user_seconds_total{instance=~\"$node:(.*)\"}, instance)",
        "hide": 0,
        "includeAll": true,
        "label": "Port",
        "multi": true,
        "name": "port",
        "options": [],
        "query": "label_values(container_cpu_user_seconds_total{instance=~\"$node:(.*)\"}, instance)",
        "refresh": 1,
        "regex": "/[^:]+:(.*)/",
        "sort": 3,
        "type": "query",
        "useTags": false
      }
    ]
  },
  "time": { "from": "now-15m", "to": "now" },
  "timepicker": {
    "refresh_intervals": ["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],
    "time_options": ["5m","15m","1h","6h","12h","24h","2d","7d","30d"]
  },
  "timezone": "browser",
  "title": "Docker Container & Host Metrics",
  "uid": "4dMaCsRZz",
  "version": 30
}
